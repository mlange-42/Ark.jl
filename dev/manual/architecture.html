<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Architecture · Ark.jl</title><meta name="title" content="Architecture · Ark.jl"/><meta property="og:title" content="Architecture · Ark.jl"/><meta property="twitter:title" content="Architecture · Ark.jl"/><meta name="description" content="Ark.jl is an archetype-based Entity Component System (ECS) for Julia."/><meta property="og:description" content="Ark.jl is an archetype-based Entity Component System (ECS) for Julia."/><meta property="twitter:description" content="Ark.jl is an archetype-based Entity Component System (ECS) for Julia."/><meta property="og:url" content="https://ark-ecs.github.io/Ark.jl/stable/manual/architecture.html"/><meta property="twitter:url" content="https://ark-ecs.github.io/Ark.jl/stable/manual/architecture.html"/><link rel="canonical" href="https://ark-ecs.github.io/Ark.jl/stable/manual/architecture.html"/><meta property="og:image" content="https://ark-ecs.github.io/Ark.jl/stable/assets/preview.png"/><meta property="twitter:image" content="https://ark-ecs.github.io/Ark.jl/stable/assets/preview.png"/><meta property="twitter:card" content="summary_large_image"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img class="docs-light-only" src="../assets/logo.svg" alt="Ark.jl logo"/><img class="docs-dark-only" src="../assets/logo-dark.svg" alt="Ark.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="quickstart.html">Quickstart</a></li><li><a class="tocitem" href="world.html">The World</a></li><li><a class="tocitem" href="entities.html">Entities</a></li><li><a class="tocitem" href="components.html">Components</a></li><li><a class="tocitem" href="queries.html">Queries</a></li><li><a class="tocitem" href="systems.html">Systems</a></li><li><a class="tocitem" href="resources.html">Resources</a></li><li><a class="tocitem" href="relations.html">Entity relationships</a></li><li><a class="tocitem" href="batch.html">Batch operations</a></li><li><a class="tocitem" href="events.html">Event system</a></li><li class="is-active"><a class="tocitem" href="architecture.html">Architecture</a><ul class="internal"><li><a class="tocitem" href="#archetypes"><span>Archetypes</span></a></li><li><a class="tocitem" href="#architecture-queries"><span>Queries</span></a></li><li><a class="tocitem" href="#component-access"><span>World component access</span></a></li><li><a class="tocitem" href="#architecture-relationships"><span>Entity relationships</span></a></li><li><a class="tocitem" href="#Archetype-removal"><span>Archetype removal</span></a></li><li><a class="tocitem" href="#Performance-implications"><span>Performance implications</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../demos.html">Demos</a></li><li><a class="tocitem" href="../benchmarks.html">Benchmarks</a></li><li><a class="tocitem" href="../api.html">Public API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="architecture.html">Architecture</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="architecture.html">Architecture</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ark-ecs/Ark.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ark-ecs/Ark.jl/blob/main/docs/src/manual/architecture.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Architecture"><a class="docs-heading-anchor" href="#Architecture">Architecture</a><a id="Architecture-1"></a><a class="docs-heading-anchor-permalink" href="#Architecture" title="Permalink"></a></h1><p>This chapter describes the principles of Ark&#39;s architecture, which may be useful to understand what is actually going on, and to understand performance trade-offs.</p><h2 id="archetypes"><a class="docs-heading-anchor" href="#archetypes">Archetypes</a><a id="archetypes-1"></a><a class="docs-heading-anchor-permalink" href="#archetypes" title="Permalink"></a></h2><p>Ark uses an archetype-based architecture (therefore its name).</p><p>An archetype represents a unique combination of components. Each archetype stores the data for all entities that share exactly that combination. You can think of an archetype as a table, where rows correspond to entities and columns represent components. The first column always contains the entity identifiers themselves.</p><p>The ASCII graph below illustrates the approach. The first column shows the entity index, which is used for <a href="architecture.html#component-access">World component access</a>. The second columns shows archetypes. In this example, the first archetype contains all entities with components A, B and C. The second archetype contains all entities with A and B, and so on. The first column of each archetype contains the entity identifier for each row.</p><pre><code class="language-text hljs"> Entities   Archetypes   Bitmasks   Component index
                                    .-----------.
                                    | A | B | C |
   E         E Comps                &#39;-----------&#39;
  |0|       |2|A|B|C|    111... &lt;-----|&lt;--|&lt;--|
  |1|---.   |8|A|B|C|                 |   |   |
  |2|   &#39;--&gt;|1|A|B|C|                 |   |   |
  |3|       |3|A|B|C|                 |   |   |
  |4|                                 |   |   |
  |6|   .--&gt;|7|A|B|      110... &lt;-----&#39;&lt;--|   |
  |7|---&#39;   |6|A|B|                       |   |
  |8|       |4|A|B|                       |   |
  |9|---.                                 |   |
  |.|   |   |5|B|C|      011... &lt;---------&#39;&lt;--&#39;
  |.|   &#39;--&gt;|9|B|C|
  |.|
  |.| &lt;===&gt; [Entity pool]</code></pre><p><em>Illustration of Ark&#39;s archetype-based architecture.</em></p><p>Each archetype has a bit mask (3rd column) that encodes its components and serves for fast checks in queries. Finally, the last column shows the component index. See the next section for details.</p><h2 id="architecture-queries"><a class="docs-heading-anchor" href="#architecture-queries">Queries</a><a id="architecture-queries-1"></a><a class="docs-heading-anchor-permalink" href="#architecture-queries" title="Permalink"></a></h2><p><a href="queries.html#Queries">Queries</a> serve for iterating and manipulating all entities that have certain components. With the architecture presented here, queries are particularly fast for several reasons:</p><ul><li>Queries make a pre-selection of relevant archetypes using the component index, based on the most &quot;rare&quot; component.</li><li>Queries do a fast bit mask check per archetype in the pre-selection.</li><li>Once an archetype is checked as matching, entities in that archetype can be iterated linearly without further checks.</li><li>Components are stored in array-like columns per archetype, so only the necessary component data needs to be loaded into the CPU cache.</li></ul><p>In worlds with a large number of archetypes, query performance can be further improved by <a href="queries.html#filter-caching">filter caching</a>.</p><h2 id="component-access"><a class="docs-heading-anchor" href="#component-access">World component access</a><a id="component-access-1"></a><a class="docs-heading-anchor-permalink" href="#component-access" title="Permalink"></a></h2><p>To retrieve components for a specific entity outside query iteration (<a href="../api.html#Ark.get_components">get_components</a>), the World maintains a list indexed by entity ID (the entity index at the very left in the graph above). Each entry in this list points to the entity&#39;s archetype and the position within the archetype&#39;s table.</p><p>This setup enables fast random access to component data, though slightly slower than query-based iteration due to the additional indirection.</p><p>Note that the entity index also contains entities that are currently not alive, because they were removed from the World. These entities are recycled when new entities are requested from the world. Therefore, besides the ID shown in the illustration, each entity also has a generation variable. It is incremented on each &quot;reincarnation&quot;, which allows to distinguish recycled from dead entities, as well as from previous or later &quot;incarnations&quot;.</p><h2 id="architecture-relationships"><a class="docs-heading-anchor" href="#architecture-relationships">Entity relationships</a><a id="architecture-relationships-1"></a><a class="docs-heading-anchor-permalink" href="#architecture-relationships" title="Permalink"></a></h2><p>Earlier, archetypes were described as flat tables. However, with Ark’s <a href="relations.html#Entity-relationships">Entity relationships</a> feature, archetypes can contain multiple sub-tables, each corresponding to a unique combination of relation targets.</p><p>As an example, we have components <code>A</code>, <code>B</code> and <code>R</code>, where <code>R</code> is a relation. Further, we have two parent entities <code>E1</code> and <code>E2</code>. When you create some entities with components <code>A B R(E1)</code> and <code>A B R(E2)</code>, i.e. with relation targets <code>E1</code> and <code>E2</code>, the following archetype is created:</p><pre><code class="language-text hljs">  Archetype [ A B R ]
    |
    |--- E1   E Comps
    |        |3|A|B|R|
    |        |6|A|B|R|
    |        |7|A|B|R|
    |
    &#39;--- E2   E Comps
             |4|A|B|R|
             |5|A|B|R|</code></pre><p><em>Relationship tables of an archetype</em></p><p>When querying without specifying a target, the archetype&#39;s tables are simply iterated if the archetype matches the filter. When querying with a relation target (and the archetype matches), the table for the target entity is looked up in a standard <code>Dict</code>.</p><p>If the archetype contains multiple relation components, a <code>Dict</code> lookup is used to get all tables matching the target that is specified first. These tables are simply iterated if no further target is specified. If more than one target is specified, the selected tables are checked for these further targets and skipped if they don&#39;t match.</p><h2 id="Archetype-removal"><a class="docs-heading-anchor" href="#Archetype-removal">Archetype removal</a><a id="Archetype-removal-1"></a><a class="docs-heading-anchor-permalink" href="#Archetype-removal" title="Permalink"></a></h2><p>Normal archetype tables without a relation are never removed, because they are not considered temporary. For relation archetypes, however, things are different. Once a target entity dies, it will never appear again (actually it could, after dying another 4,294,967,294 times).</p><p>In Ark, empty tables with a dead relationship target are recycled. They are deactivated, but their allocated memory for entities and components is retained. When a table in the same archetype, but for another target entity is requested, a recycled table is reused if available. To be able to efficiently detect whether a table can be removed, a bitset is used to keep track of entities that are the target of a relationship.</p><h2 id="Performance-implications"><a class="docs-heading-anchor" href="#Performance-implications">Performance implications</a><a id="Performance-implications-1"></a><a class="docs-heading-anchor-permalink" href="#Performance-implications" title="Permalink"></a></h2><p>Archetypes are primarily designed to maximize iteration speed by grouping entities with identical component sets into tightly packed memory layouts. This structure enables blazing-fast traversal and component access during queries.</p><p>However, this optimization comes with a trade-off: Adding or removing components from an entity, as well as setting relationship targets, requires relocating it to a different archetype, essentially moving all of its component data. This operation typically costs ≈20ns per involved component, plus some baseline cost.</p><p>To reduce the number of archetype changes, it is recommended to add/remove/exchange multiple components at the same time rather than one after the other. Further, operations can be <a href="batch.html#Batch-operations">batched</a> to manipulate many entities in a single command.</p><p>For detailed benchmarks and performance metrics, refer to the <a href="../benchmarks.html#Benchmarks">Benchmarks</a> chapter.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="events.html">« Event system</a><a class="docs-footer-nextpage" href="../demos.html">Demos »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 27 December 2025 23:06">Saturday 27 December 2025</span>. Using Julia version 1.12.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
