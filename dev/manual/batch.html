<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Batch operations · Ark.jl</title><meta name="title" content="Batch operations · Ark.jl"/><meta property="og:title" content="Batch operations · Ark.jl"/><meta property="twitter:title" content="Batch operations · Ark.jl"/><meta name="description" content="Ark.jl is an archetype-based Entity Component System (ECS) for Julia."/><meta property="og:description" content="Ark.jl is an archetype-based Entity Component System (ECS) for Julia."/><meta property="twitter:description" content="Ark.jl is an archetype-based Entity Component System (ECS) for Julia."/><meta property="og:url" content="https://ark-ecs.github.io/Ark.jl/stable/manual/batch.html"/><meta property="twitter:url" content="https://ark-ecs.github.io/Ark.jl/stable/manual/batch.html"/><link rel="canonical" href="https://ark-ecs.github.io/Ark.jl/stable/manual/batch.html"/><meta property="og:image" content="https://ark-ecs.github.io/Ark.jl/stable/assets/preview.png"/><meta property="twitter:image" content="https://ark-ecs.github.io/Ark.jl/stable/assets/preview.png"/><meta property="twitter:card" content="summary_large_image"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img class="docs-light-only" src="../assets/logo.svg" alt="Ark.jl logo"/><img class="docs-dark-only" src="../assets/logo-dark.svg" alt="Ark.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="quickstart.html">Quickstart</a></li><li><a class="tocitem" href="world.html">The World</a></li><li><a class="tocitem" href="entities.html">Entities</a></li><li><a class="tocitem" href="components.html">Components</a></li><li><a class="tocitem" href="queries.html">Queries</a></li><li><a class="tocitem" href="systems.html">Systems</a></li><li><a class="tocitem" href="resources.html">Resources</a></li><li><a class="tocitem" href="relations.html">Entity relationships</a></li><li class="is-active"><a class="tocitem" href="batch.html">Batch operations</a><ul class="internal"><li><a class="tocitem" href="#Creating-entities"><span>Creating entities</span></a></li><li><a class="tocitem" href="#Removing-entities"><span>Removing entities</span></a></li><li><a class="tocitem" href="#Adding-and-removing-components"><span>Adding and removing components</span></a></li><li><a class="tocitem" href="#Setting-relationships"><span>Setting relationships</span></a></li></ul></li><li><a class="tocitem" href="events.html">Event system</a></li><li><a class="tocitem" href="architecture.html">Architecture</a></li></ul></li><li><a class="tocitem" href="../demos.html">Demos</a></li><li><a class="tocitem" href="../benchmarks.html">Benchmarks</a></li><li><a class="tocitem" href="../api.html">Public API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="batch.html">Batch operations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="batch.html">Batch operations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ark-ecs/Ark.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ark-ecs/Ark.jl/blob/main/docs/src/manual/batch.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Batch-operations"><a class="docs-heading-anchor" href="#Batch-operations">Batch operations</a><a id="Batch-operations-1"></a><a class="docs-heading-anchor-permalink" href="#Batch-operations" title="Permalink"></a></h1><p>In an <a href="architecture.html#Architecture">archetype-based</a> ECS, creation and removal of entities or components are relatively costly operations. For these operations, Ark provides batched versions. This allows to create or manipulate a large number of entities much faster than one by one. All batch methods come in two flavors. A &quot;normal&quot; one, and one that runs a callback function on the affected entities.</p><h2 id="Creating-entities"><a class="docs-heading-anchor" href="#Creating-entities">Creating entities</a><a id="Creating-entities-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-entities" title="Permalink"></a></h2><p>Often, multiple entities with the same set of components are created at the same time. Batch entity creation is therefore probably the most frequently used batch operation. There are different ways to create entities in batches:</p><p>From <strong>default component values</strong> using <a href="../api.html#Ark.new_entities!">new_entities!</a>. Here, we create 100 entities, all with the same <code>Position</code> and <code>Velocity</code>:</p><pre><code class="language-julia hljs">new_entities!(world, 100, (
    Position(100, 100),
    Velocity(0, 0),
))</code></pre><p>This may be sufficient in some use cases, but most often we will use a second approach:</p><p>From <strong>component types</strong> with subsequent manual initialization using <a href="../api.html#Ark.new_entities!">new_entities!</a> with a tuple of types:</p><pre><code class="language-julia hljs">new_entities!(world, 100, (Position, Velocity)) do (entities, positions, velocities)
    for i in eachindex(entities)
        positions[i] = Position(i, i)
        velocities[i] = Velocity(0, 0)
    end
end</code></pre><p>Note that the tuple elements of the callback argument are entity and component columns that need to be iterated to access individual items. See also the chapter on <a href="queries.html#Queries">Queries</a>, which use a similar nested loop structure.</p><p>Note that with the second approach, all components of all entities should be set as they are otherwise uninitialized. Therefore, the callback is mandatory here, while it is optional for batch creation from default values.</p><h2 id="Removing-entities"><a class="docs-heading-anchor" href="#Removing-entities">Removing entities</a><a id="Removing-entities-1"></a><a class="docs-heading-anchor-permalink" href="#Removing-entities" title="Permalink"></a></h2><p>Similar to entity creation, entities can also be removed in batches with <a href="../api.html#Ark.remove_entities!">remove_entities!</a>. It takes a <a href="../api.html#Ark.Filter">Filter</a> instead of a single entity as argument:</p><pre><code class="language-julia hljs">filter = Filter(world, (Position, Velocity))
remove_entities!(world, filter)</code></pre><p>If something needs to be done with the entities to be removed, a callback can be used, which takes an <a href="../api.html#Ark.Entities">Entities column</a> as an argument:</p><pre><code class="language-julia hljs">filter = Filter(world, (Position, Velocity))
remove_entities!(world, filter) do entities
    # do something with the entities...
end</code></pre><h2 id="Adding-and-removing-components"><a class="docs-heading-anchor" href="#Adding-and-removing-components">Adding and removing components</a><a id="Adding-and-removing-components-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-and-removing-components" title="Permalink"></a></h2><p>The functions <a href="../api.html#Ark.add_components!">add_components!</a>, <a href="../api.html#Ark.remove_components!">remove_components!</a> and <a href="../api.html#Ark.exchange_components!">exchange_components!</a> also come with batch versions.</p><p>Similarly to batch entity creation, components to be added can be given either in the form of default values, or as types. In the case of default values, usage of the callback is optional, while it is mandatory for initialization with the types version.</p><p>Here, we add a default <code>Velocity</code> component to all entities with <code>Position</code>, using <a href="../api.html#Ark.add_components!">add_components!</a>:</p><pre><code class="language-julia hljs">filter = Filter(world, (Position,))
add_components!(world, filter, (Velocity(0, 0),))</code></pre><p>Adding components via types, with individual initialization:</p><pre><code class="language-julia hljs">filter = Filter(world, (Position,))
add_components!(world, filter, (Velocity,)) do (entities, velocities)
    for i in eachindex(entities, velocities)
        velocities[i] = Velocity(randn(), randn())
    end
end</code></pre><p>Note that the tuple elements of the callback argument are entity and component columns that need to be iterated to access individual items. See also the chapter on <a href="queries.html#Queries">Queries</a>, which use a similar nested loop structure.</p><p>Removing components works in a similar way, with <a href="../api.html#Ark.remove_components!">remove_components!</a>:</p><pre><code class="language-julia hljs">filter = Filter(world, (Velocity,))
remove_components!(world, filter, (Velocity,))</code></pre><p>Note that the optional callback has only an <a href="../api.html#Ark.Entities">Entities column</a> as argument:</p><pre><code class="language-julia hljs">filter = Filter(world, (Velocity,))
remove_components!(world, filter, (Velocity,)) do entities
    # do something with the entities...
end</code></pre><p>Finally, exchanging components with <a href="../api.html#Ark.exchange_components!">exchange_components!</a> follows the same pattern as adding components:</p><pre><code class="language-julia hljs">filter = Filter(world, (Velocity,))
exchange_components!(world, filter;
    add=(Health(100),),
    remove=(Velocity,),
)</code></pre><p>Note that, again, when adding components as types, the callback is mandatory. Also note that only the added components are part of the callback&#39;s argument tuple, while the removed components are not.</p><pre><code class="language-julia hljs">filter = Filter(world, (Velocity,))
exchange_components!(world, filter;
    add=(Health,),
    remove=(Velocity,),
) do (entities, healths)
    for i in eachindex(entities, healths)
        healths[i] = Health(i * 2)
    end
end</code></pre><h2 id="Setting-relationships"><a class="docs-heading-anchor" href="#Setting-relationships">Setting relationships</a><a id="Setting-relationships-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-relationships" title="Permalink"></a></h2><p>As with other operations, relation targets can be set in batches using <a href="../api.html#Ark.set_relations!">set_relations!</a> combined with a <a href="../api.html#Ark.Filter">Filter</a>:</p><pre><code class="language-julia hljs">filter = Filter(world, (ChildOf,); relations=(ChildOf =&gt; parent,))
set_relations!(world, filter, (ChildOf =&gt; parent2,))</code></pre><p>If necessary, the affected entities can be processed using a callback function:</p><pre><code class="language-julia hljs">filter = Filter(world, (ChildOf,); relations=(ChildOf =&gt; parent,))
set_relations!(world, filter, (ChildOf =&gt; parent2,)) do entities
    # do something with the entities...
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="relations.html">« Entity relationships</a><a class="docs-footer-nextpage" href="events.html">Event system »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 27 December 2025 23:06">Saturday 27 December 2025</span>. Using Julia version 1.12.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
