<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Queries ¬∑ Ark.jl</title><meta name="title" content="Queries ¬∑ Ark.jl"/><meta property="og:title" content="Queries ¬∑ Ark.jl"/><meta property="twitter:title" content="Queries ¬∑ Ark.jl"/><meta name="description" content="Ark.jl is an archetype-based Entity Component System (ECS) for Julia."/><meta property="og:description" content="Ark.jl is an archetype-based Entity Component System (ECS) for Julia."/><meta property="twitter:description" content="Ark.jl is an archetype-based Entity Component System (ECS) for Julia."/><meta property="og:url" content="https://mlange-42.github.io/Ark.jl/stable/manual/queries.html"/><meta property="twitter:url" content="https://mlange-42.github.io/Ark.jl/stable/manual/queries.html"/><link rel="canonical" href="https://mlange-42.github.io/Ark.jl/stable/manual/queries.html"/><meta property="og:image" content="https://mlange-42.github.io/Ark.jl/stable/assets/preview.png"/><meta property="twitter:image" content="https://mlange-42.github.io/Ark.jl/stable/assets/preview.png"/><meta property="twitter:card" content="summary_large_image"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img class="docs-light-only" src="../assets/logo.svg" alt="Ark.jl logo"/><img class="docs-dark-only" src="../assets/logo-dark.svg" alt="Ark.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="quickstart.html">Quickstart</a></li><li><a class="tocitem" href="world.html">The World</a></li><li><a class="tocitem" href="entities.html">Entities</a></li><li><a class="tocitem" href="components.html">Components</a></li><li class="is-active"><a class="tocitem" href="queries.html">Queries</a><ul class="internal"><li><a class="tocitem" href="#Basic-queries"><span>Basic queries</span></a></li><li><a class="tocitem" href="#Advanced-queries"><span>Advanced queries</span></a></li><li><a class="tocitem" href="#Component-field-views"><span>Component field views</span></a></li><li><a class="tocitem" href="#world-lock"><span>World lock</span></a></li></ul></li><li><a class="tocitem" href="systems.html">Systems</a></li><li><a class="tocitem" href="resources.html">Resources</a></li><li><a class="tocitem" href="events.html">Event system</a></li><li><a class="tocitem" href="architecture.html">Architecture</a></li></ul></li><li><a class="tocitem" href="../demos.html">Demos</a></li><li><a class="tocitem" href="../benchmarks.html">Benchmarks</a></li><li><a class="tocitem" href="../api.html">Public API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="queries.html">Queries</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="queries.html">Queries</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mlange-42/Ark.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mlange-42/Ark.jl/blob/main/docs/src/manual/queries.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Queries"><a class="docs-heading-anchor" href="#Queries">Queries</a><a id="Queries-1"></a><a class="docs-heading-anchor-permalink" href="#Queries" title="Permalink"></a></h1><p>Queries allow to select <a href="entities.html#Entities">Entities</a> that have a certain set of <a href="components.html#Components">Components</a> and to manipulate them.</p><p>Queries are the heart of every ECS and the main reason for its flexibility and performance. In Ark, queries are blazing fast and should be used to write the game or model logic where possible. For cases where components of a particular entity are required, see section <a href="components.html#Accessing-components">Accessing components</a>.</p><h2 id="Basic-queries"><a class="docs-heading-anchor" href="#Basic-queries">Basic queries</a><a id="Basic-queries-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-queries" title="Permalink"></a></h2><p>By default, a <a href="../api.html#queries-api">Query</a> iterates over all entities that have the query&#39;s components, and provides efficient access to these components.</p><p>Here, we are interested only in non-exclusive sets. So the entities that are processed may have further components, but these are not of interest for that particular piece of game or model logic.</p><pre><code class="language-julia hljs">for (entities, positions, velocities) in Query(world, (Position, Velocity))
    @inbounds for i in eachindex(entities)
        pos = positions[i]
        vel = velocities[i]
        positions[i] = Position(pos.x + vel.dx, pos.y + vel.dy)
    end
end</code></pre><p>Note the nested loop! In the outer loop, the query iterates the <a href="architecture.html#Architecture">archetypes</a>, and for each one returns a vector of entities and the columns for the queried components. In the inner loop, we iterate over the entities within the archetype and perform the actual logic.</p><p>Also note the last line in the inner loop. Here, we assign a new <code>Position</code> value to the current entity. This is necessary as <code>Position</code> is immutable, which is the default and highly recommended. See section <a href="components.html#Component-types">Component types</a> for details.</p><p>The <code>@inbounds</code> macro in front of the inner loop is optional, but it is safe to use here and makes the iteration faster as it allows the compiler to skip bounds checks.</p><h2 id="Advanced-queries"><a class="docs-heading-anchor" href="#Advanced-queries">Advanced queries</a><a id="Advanced-queries-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-queries" title="Permalink"></a></h2><p>Query filters can be configured further, to include or exclude additional components.</p><h3 id="with"><a class="docs-heading-anchor" href="#with"><code>with</code></a><a id="with-1"></a><a class="docs-heading-anchor-permalink" href="#with" title="Permalink"></a></h3><p>Queries provide an optional <code>with</code> argument that filters for additional components that entities must have, but that are not used by the query.</p><pre><code class="language-julia hljs">for (entities, positions, velocities) in Query(world,
            (Position, Velocity);
            with=(Health,)
        )
    @inbounds for i in eachindex(entities)
        # ...
    end
end</code></pre><h3 id="without"><a class="docs-heading-anchor" href="#without"><code>without</code></a><a id="without-1"></a><a class="docs-heading-anchor-permalink" href="#without" title="Permalink"></a></h3><p>The optional <code>without</code> argument allows to exclude entities that have certain components:</p><pre><code class="language-julia hljs">for (entities, positions, velocities) in Query(world,
            (Position, Velocity);
            without=(Health,)
        )
    @inbounds for i in eachindex(entities)
        # ...
    end
end</code></pre><h3 id="exclusive"><a class="docs-heading-anchor" href="#exclusive"><code>exclusive</code></a><a id="exclusive-1"></a><a class="docs-heading-anchor-permalink" href="#exclusive" title="Permalink"></a></h3><p>The optional <code>exclusive</code> argument excludes entities that have any other then the query&#39;s components and those specified by <code>with</code>. So it acts like an exhaustive <code>without</code>:</p><pre><code class="language-julia hljs">for (entities, positions, velocities) in Query(world,
            (Position, Velocity);
            exclusive=true
        )
    @inbounds for i in eachindex(entities)
        # ...
    end
end</code></pre><h3 id="optional"><a class="docs-heading-anchor" href="#optional"><code>optional</code></a><a id="optional-1"></a><a class="docs-heading-anchor-permalink" href="#optional" title="Permalink"></a></h3><p>The optional <code>optional</code> argument adds optional component. üòâ</p><p>Entities are included irrespective of presence of these components on them. Columns for these components are added at the end of the query iterator tuple. They are <code>nothing</code> if the current <a href="architecture.html#Architecture">archetype</a> does not have them.</p><pre><code class="language-julia hljs">for (entities, positions, velocities, healths) in Query(world,
            (Position, Velocity);
            optional=(Health,)
        )
    has_healths = healths !== nothing
    @inbounds for i in eachindex(entities)
        # ...
    end
end</code></pre><p>Note that it is possible to branch already outside of the inner loop, as all entities in an archetype either have a component or don&#39;t.</p><h2 id="Component-field-views"><a class="docs-heading-anchor" href="#Component-field-views">Component field views</a><a id="Component-field-views-1"></a><a class="docs-heading-anchor-permalink" href="#Component-field-views" title="Permalink"></a></h2><p>Individual fields of components can be accessed as vectors in queries, e.g. using <a href="../api.html#Ark.@unpack">@unpack</a>. This is particularly useful for components that use the StructArray <a href="components.html#component-storages">storage modes</a>, as it allows for SIMD-accelerated vectorized operations.</p><pre><code class="language-julia hljs">world = World(
    Position =&gt; StructArrayStorage,
    Velocity =&gt; StructArrayStorage,
)

# ...

for columns in Query(world, (Position, Velocity))
    @unpack entities, (x, y), (dx, sy) = columns
    @inbounds x .+= dx
    @inbounds y .+= dy
end</code></pre><p>However, when iterating components that use StructArray storage without unpacking individual fields, there is a certain overhead and SIMD optimization may not be possible.</p><p>Note that it is also possible to access field vectors by the field&#39;s name:</p><pre><code class="language-julia hljs">for (_, positions, velocities) in Query(world, (Position, Velocity))
    @inbounds positions.x .+= velocities.dx
    @inbounds positions.y .+= velocities.dy
end</code></pre><h2 id="world-lock"><a class="docs-heading-anchor" href="#world-lock">World lock</a><a id="world-lock-1"></a><a class="docs-heading-anchor-permalink" href="#world-lock" title="Permalink"></a></h2><p>During query iteration, the World is locked for modifications like entity creation and removal and component addition and removal. This is necessary to prevent changes to the inner storage structure of the World that would result in undefined behavior of the query.</p><p>Whenever the game or model logic demands one of these forbidden operations, the entities to be affected must first be collected into a <code>Vector</code>, and the operations must be applied only after the query iteration has finished.</p><pre><code class="language-julia hljs"># vector for entities to be removed from te world
to_remove = Entity[]

for (entities, positions) in Query(world, (Position,))
    @inbounds for i in eachindex(entities)
        pos = positions[i]

        # collect entities for removal
        if pos.y &lt; 0
            push!(to_remove, entities[i])
        end
    end
end

# actual removal
for entity in to_remove
    remove_entity!(world, entity)
end

# clear the vector for re-use
resize!(to_remove, 0)</code></pre><p>For the best performance, such a Vector should be stored persistently and re-used to avoid repeated memory allocations.</p><p>The world is automatically unlocked when query iteration finishes. When breaking out of a query loop, however, it must be unlocked by calling <a href="../api.html#Ark.close!-Tuple{Query}">close!</a> on the query.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="components.html">¬´ Components</a><a class="docs-footer-nextpage" href="systems.html">Systems ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 26 November 2025 13:21">Wednesday 26 November 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
