
name: Upload coverage
runs-on: ubuntu-latest
needs: test
if: success()
permissions:
  contents: read # Required for actions/checkout to get git history

steps:
  - name: Checkout code
    uses: actions/checkout@v4

  - name: Download all coverage artifacts
    uses: actions/download-artifact@v4
    with:
      path: coverage_artifacts

  - name: Upload coverage to Codecov
    uses: codecov/codecov-action@v5
    with:
      # specific directory where artifacts were downloaded
      directory: coverage_artifacts
      token: ${{ secrets.CODECOV_TOKEN }}
      fail_ci_if_error: true
      verbose: true # Optional: prints extra info to logs to confirm it found all files